name: Deploy to DigitalOcean

on:
  push:
    branches:
      - main  # Changez cela selon le nom de votre branche principale

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Deploy to DigitalOcean
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.KEY }}
        port: 22
        script: |
            # Navigation vers le répertoire de gestion-event
            cd ~/gestion-event
            
            # Vérification de l'existence du dossier AppliCalLocal
            if [ ! -d "AppliCalLocal" ]; then
                echo "Cloning AppliCalLocal..."
                git clone https://github.com/Zainados2/gestion-event.git AppliCalLocal
            else
                echo "Updating AppliCalLocal..."
                cd AppliCalLocal
                git pull origin main
            fi
            
            # Lancer les commandes Docker
            cd AppliCalLocal  # Assurez-vous d'être dans le bon répertoire
            docker-compose down  # Stoppe et supprime les conteneurs existants
            docker-compose up -d --build  # Reconstruit et démarre les conteneurs en mode détaché
            echo 'Deployment to DigitalOcean finished'
